# NATS Server Configuration

# Network
port: 4222
host: 0.0.0.0

# HTTP monitoring
monitor_port: 8222
server_name: nats-docker

# Logging
log_time: true
debug: false
trace: false
logfile: "/dev/stdout"

# Limits
max_connections: 64K
max_control_line: 4KB
max_payload: 1MB
max_pending: 64MB
max_subscriptions: 0

# Timeouts (in seconds)
ping_interval: 120
ping_max: 2
write_deadline: "10s"

# Authentication (using file-based auth)
include "./secrets/auth.conf"

# JetStream (NATS streaming)
jetstream {
    # Enable JetStream
    enabled: true
    
    # Store directory
    store_dir: "/data/jetstream"
    
    # Memory and file storage limits
    max_memory_store: 256MB
    max_file_store: 2GB
    
    # Domain (for multi-tenant scenarios)
    domain: "hub"
}

# Cluster configuration (for multi-node setup)
cluster {
    name: nats-cluster
    
    # Routes for cluster communication
    listen: 0.0.0.0:6222
    
    # Uncomment and configure for multi-node clusters
    # routes = [
    #     nats://nats-1:6222
    #     nats://nats-2:6222
    #     nats://nats-3:6222
    # ]
    
    # Cluster auth (if needed)
    # authorization {
    #     user: cluster_user
    #     password: cluster_password
    #     timeout: 2
    # }
}

# TLS Configuration (uncomment to enable)
# tls {
#     cert_file: "/etc/nats/certs/server.crt"
#     key_file: "/etc/nats/certs/server.key"
#     ca_file: "/etc/nats/certs/ca.crt"
#     verify: true
#     timeout: 5
# }

# Gateway configuration (for supercluster)
# gateway {
#     name: "local"
#     listen: "0.0.0.0:7222"
#     gateways: [
#         {name: "remote", urls: ["nats://remote-nats:7222"]}
#     ]
# }

# Leafnode configuration (for edge connectivity)
# leafnodes {
#     listen: "0.0.0.0:7422"
#     remotes: [
#         {
#             url: "nats-leaf://hub-nats:7422"
#             account: "leafnode_account"
#         }
#     ]
# }

# System account (for monitoring and management)
system_account: SYS

# WebSocket configuration (uncomment to enable)
# websocket {
#     port: 8080
#     no_tls: true
# }

# MQTT configuration (uncomment to enable)
# mqtt {
#     port: 1883
# }

# Accounts and users configuration
accounts {
    SYS: {
        users: [
            {
                user: sys_user,
                password: $SYS_PASSWORD
            }
        ]
    },
    APP: {
        users: [
            {
                user: app_user,
                password: $APP_PASSWORD,
                permissions: {
                    publish: {
                        allow: ["app.>", "events.>"]
                    },
                    subscribe: {
                        allow: ["app.>", "events.>", "_INBOX.>"]
                    }
                }
            },
            {
                user: admin,
                password: $ADMIN_PASSWORD,
                permissions: {
                    publish: {
                        allow: [">"]
                    },
                    subscribe: {
                        allow: [">"]
                    }
                }
            }
        ]
    }
}

# Default account mapping
no_auth_user: app_user
